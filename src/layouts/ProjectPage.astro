---
import Base from "./Base.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import type { CollectionEntry } from "astro:content";
import { formatDate } from "../utils/posts";
import { formatAwards } from "../utils/projects";

interface Props {
  name: string;
  description: string;
  coverImage?: {
    src: ImageMetadata;
    alt: string;
  };
  images?: Array<{
    src: ImageMetadata;
    alt: string;
  }>;
  year: string;
  status: "active" | "archived" | "maintained";
  tags: string[];
  links: {
    github?: string;
    demo?: string;
    npm?: string;
    docs?: string;
  };
  awards?: Array<{
    name: string;
    event?: string;
    year?: string;
  }>;
  relatedPosts?: CollectionEntry<"post">[];
}

const { name, description, coverImage, images = [], year, status, tags, links, awards = [], relatedPosts = [] } = Astro.props;
---

<Base title={`${name} — justinmeimar`} description={description}>
  <div class="max-w-2xl mx-auto px-6 py-12 md:py-20 topo-mask">
    <Header activeSection="projects" />

    <article class="animate-fade-up stagger-1" data-pagefind-body>
      <!-- Project header -->
      <header class="mb-8" data-pagefind-ignore>
        <div class="flex items-baseline gap-4 mb-3 font-mono text-xs text-[var(--text-faint)]">
          <span>{year}</span>
          <span>·</span>
          <span>{status}</span>
        </div>

        <h1 class="font-serif text-3xl md:text-4xl font-normal tracking-tight mb-2">
          {name}
        </h1>

        <p class="font-mono text-sm text-[var(--text-muted)] mb-6">
          {description}
        </p>

        <!-- Awards as simple text -->
        {awards.length > 0 && (
          <p class="font-mono text-xs text-[var(--text-faint)] mb-6 tracking-wide uppercase">
            <span class="text-[var(--accent-pop)] opacity-70 mr-1">◆</span>
            {formatAwards(awards)}
          </p>
        )}

        <!-- Links -->
        <div class="flex flex-wrap gap-4 mb-6">
          {links.github && (
            <a
              href={links.github}
              target="_blank"
              rel="noopener"
              class="font-mono text-xs text-[var(--text-muted)] hover:text-[var(--text)] transition-colors"
            >
              GitHub ↗
            </a>
          )}
          {links.demo && (
            <a
              href={links.demo}
              target="_blank"
              rel="noopener"
              class="font-mono text-xs text-[var(--text-muted)] hover:text-[var(--text)] transition-colors"
            >
              Demo ↗
            </a>
          )}
          {links.docs && (
            <a
              href={links.docs}
              target="_blank"
              rel="noopener"
              class="font-mono text-xs text-[var(--text-muted)] hover:text-[var(--text)] transition-colors"
            >
              Docs ↗
            </a>
          )}
        </div>

        <!-- Tags -->
        <div class="flex flex-wrap gap-x-3 gap-y-1">
          {tags.map((tag) => (
            <a
              href={`/tags/${tag}`}
              class="font-mono text-[10px] text-[var(--text-faint)] hover:text-[var(--text-muted)] transition-colors"
            >
              #{tag}
            </a>
          ))}
        </div>
      </header>

      <!-- Cover image -->
      {coverImage && (
        <div class="mb-12 rounded border border-[var(--border)] overflow-hidden">
          <Image
            src={coverImage.src}
            alt={coverImage.alt}
            class="w-full h-auto"
            widths={[400, 800, 1200]}
            sizes="(max-width: 768px) 100vw, 800px"
          />
        </div>
      )}

      <!-- Divider -->
      <div class="mb-12 h-px bg-[var(--border)]"></div>

      <!-- Project content -->
      <div class="prose">
        <slot />
      </div>

      <!-- Related posts -->
      {relatedPosts.length > 0 && (
        <div class="mt-12">
          <h2 class="font-mono text-xs tracking-widest uppercase text-[var(--text-muted)] mb-6">
            Related Writing
          </h2>
          <div class="space-y-4">
            {relatedPosts.map((post) => (
              <a
                href={`/posts/${post.id}`}
                class="group block p-4 -mx-4 rounded hover:bg-[var(--bg-paper)] transition-colors"
              >
                <div class="flex items-baseline justify-between gap-4 mb-1">
                  <h3 class="font-serif text-base group-hover:underline decoration-1 underline-offset-4">
                    {post.data.title}
                  </h3>
                  <span class="font-mono text-[10px] text-[var(--text-faint)] flex-shrink-0">
                    {formatDate(post.data.publishDate)}
                  </span>
                </div>
                <p class="font-mono text-xs text-[var(--text-muted)] line-clamp-1">
                  {post.data.description}
                </p>
              </a>
            ))}
          </div>
        </div>
      )}

      <!-- Additional images gallery -->
      {images.length > 0 && (
        <div class="mt-12">
          <h2 class="font-mono text-xs tracking-widest uppercase text-[var(--text-muted)] mb-6">
            Gallery
          </h2>
          <div class="space-y-6">
            {images.map((image) => (
              <div class="rounded border border-[var(--border)] overflow-hidden">
                <Image
                  src={image.src}
                  alt={image.alt}
                  class="w-full h-auto"
                  widths={[400, 800, 1200]}
                  sizes="(max-width: 768px) 100vw, 800px"
                />
                <p class="p-3 font-mono text-xs text-[var(--text-faint)] bg-[var(--bg-paper)]">
                  {image.alt}
                </p>
              </div>
            ))}
          </div>
        </div>
      )}

      <!-- Project footer -->
      <footer class="mt-16" data-pagefind-ignore>
        <div class="h-px bg-[var(--border)] mb-12"></div>

        <a
          href="/projects"
          class="inline-flex items-center gap-2 font-mono text-xs text-[var(--text-muted)] hover:text-[var(--text)] transition-colors"
        >
          <span>←</span>
          <span>Back to all projects</span>
        </a>
      </footer>
    </article>

    <div class="mt-16">
      <Footer />
    </div>
  </div>
</Base>
